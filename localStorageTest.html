<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, 
initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>localStorage Test</title>
<script src="libs/jquery191min.js"></script>
<script src="libs/FormatDate.js"></script>
<style>
    .red {
        color:red;
    }
</style>
</head>

<body>
    <p class="alert"></p>
	<p class="content"></p>
    <div class="save1" onclick="saveData(0)">Alic level 5 - May 9th 09:19</div>
    <div class="save2" onclick="saveData(1)">Slot 2</div>
    <div class="save3" onclick="saveData(2)">Slot 3</div>
    <div class="save4" onclick="saveData(3)">Slot 4</div>
    <div class="save5" onclick="saveData(4)">Slot 5</div>
    
    
    <script>
		if(window.localStorage){
			$('.alert').append('This browser <span class="red">supports</span> localStorage.');
            //alert('This browser supports localStorage.');            
		}else{
			$('.alert').append('This browser <span class="red">doest NOT support</span> localStorage.');
            //alert('This browser does NOT supports localStorage.'); 
		}
        
        var creat = new Date();
        var now = new Date();
        //var newSave = new Array();
        var getSave = new Array();
        var saveLength = 5;
        var selectSlot;
		
        /*****
		if (!localStorage.save){
            for (var i=0;i<saveLength;i++){
                newSave[i] = {
                    name : "Jason",
                    //saveSlot: i,
                    level : i*2,
                    score : i*500,
                    numLive : 10,
                    numShield : 5,
                    numBomb : 6,
                    numFreeze : 4,
                    numEnemyKilled : 15,
                    lastSave : 0,
                    createTime: creat.customFormat("#MMM# #D##th# #hh#:#mm#"),
                    version : 0
                };
            }
            localStorage.setItem('save', JSON.stringify(newSave));
		}
        *****/
		
        for (var i=0;i<saveLength;i++){
			if (localStorage['save'+i]){
				//get data from localStorage
                getSave[i] = new Object();
				getSave[i] = JSON.parse(localStorage.getItem('save'+i));
				//update
				//LSupdate(getSave[i],'save'+i);
				//print out the object
				//$('.content').append('<p>This is the <span class="red">' + getSave[i].version + "th</span> time that the object, localStorage.save, has been getd from the localStorage.</p>");
				//$('.content').append("<p>" + JSON.stringify(getSave[i]) + "</p>");
                $('.save'+(i+1)).text(getSave[i].name + " level " + getSave[i].level + " - " + getSave[i].lastSave);
			}
		}
		
		function LSupdate(pending,update){
			//add 1 to the version
			pending.version ++;
			//update last save date
			pending.lastSave = now.customFormat("#MMM# #D##th# #hh#:#mm#");
			//update the version
			localStorage.setItem(update,JSON.stringify(pending));
		}
		
		function LSget(pending,getData){
			//get data from localStorage
			pending = JSON.parse(localStorage.getItem(getData));
		}

		function saveData(i){
            if(!getSave[i]){
				getSave[i] = {
					name : prompt("What yousa name?"),
                    slot: i+1,
					level : 0,
					score : 0,
					numLive : 3,
					numShield : 0,
					numBomb : 0,
					numFreeze : 0,
					numEnemyKilled : 0,
					lastSave : 0,
					createTime: creat.customFormat("#MMM# #D##th# #hh#:#mm#"),
					version : 0
				};
                if(getSave[i].name){
                    if(getSave[i].name.length>0) {
                        LSupdate(getSave[i],'save'+i)
                    }
                }else{
                    getSave[i] = "";
                }
            }else{
                selectSlot = i+1;
                alert("Yousa select slot " + selectSlot + "!");
            }
		}
	</script>
</body>
</html>
